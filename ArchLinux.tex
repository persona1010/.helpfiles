systemctl - все модули systemd 
systemctl list-units --type=service - все запущенные службы
systemctl list-units --type=service --state=active
systemctl list-units --type=service --state=running
inxi -b - Информация о железе.
stat <file> - Информация о файле.

env - Просмотр текущих переменных окружения.

sudo libinput debug-events --show-keycodes - Отображает кейкоды клавиш.

% -----------------------------------------------------------------------------
% - SOUND
% -----------------------------------------------------------------------------

pw-top - Список Device и Node используемые в настоящее время.
wpclt status - Объекты которыми управляет WirePlumb.
wpclt inspect <ID>
cat /proc/asound/modules - Список модулей и порядок их загрузки.
lsmod | grep '^snd' | column -t - Список звуковых модулей(драйверов).
modprobe <module_name> - Загружает модуль вручтую.
aplay -L | grep :CARD
systemctl --user stop wireplumber
systemctl --user start wireplumber

pactl info - pipewire info
pactl list sinks - Информация об устройствах воиспроизведения, также тут можно
    уточнить информацию о кодеке используемом в Bluetooth устройстве.

% -----------------------------------------------------------------------------
% BASH
% -----------------------------------------------------------------------------
ls -l              - более подробная информация о содетжимом каталога.
grep <regex>       - фильтр с параметром <regex>, -i caseinsensitive, -v invert filtr
less               - вывод файла по частям, соответствующим одному экрану.
pwd                - показать working directory
diff <file> <file> - различия между файлами.
file <file>        - формат файла. 
find [<path>] [opt] [expr] - search files.
    opt:
        -type {f,d,...} - тип субъекта поиска.
        -name "name,expr" - имя или "regexp" указывающий на файл.
        -perm 664 - ищет файлы с указанным chmod.
        -mtime {+,-, } -7 - ищет файлч по дате последнего изменения (за 
            последние семь дней в данном случае).
        -cmin  {+,-, } +60 - все файлы кроме измененных за последний час.
        -atime {+,-, } +180 - по дате последнего доступа (за последние пол года
            в данном случае).
        -size  {+,-, } +1G - ищет по размеру. +/-, значит - больше/меньше 
            указанного размера. Без знака - точное соответствие. 
            Ед: c - байт, k - кило, M - мега, G - гига.
        -empty - ищет пустые файлы.
        -user username - ищет по пользователю.
        -or, -and, -not - объединяет несколько критериев в одну комманду.
    expr:
        -delete
        -ls
        -print
        -exec <command -key> {} \; - выполняет команду над каждым "{}" 
            результатом поиска.
head, tail         - показывает начало/конец файла.
sort               - сортирует строки текста. -n в порядке следования чисел. -r реверс.

% Переменные окружения
$ varname=value    - создает переменную оболочки среды BASH.
$ echo $varname    - вернет value.
$ export varname   - создает из переменной varname переменную окружения.
$ echo $PATH       - содержит пути по которым BASH ищет исполняемые комманды, 
                     приоритет по очередности.
$ PATH = $PATH:dir - добавляет свой путь в конец массива разделённого символом ':'.
% --SHORTCUT---------ACTION----------------------
    Ctrl + B       - move cursor Back.
    Ctrl + F       - move cursor Forward. 
    Ctrl + P       - Ptevious command.
    Ctrl + N       - Next command.
    Ctrl + A       - move cursor to start.
    Ctrl + E       - move cursor to End.
    Ctrl + W       - delete Word (before cursor)
    Ctrl + U       - delete to begin.
    Ctrl + K       - delete to end.
    Ctrl + Y       - undo delete.
% -----------------------------------------------
$ command > file   - Вывод в файл с заменой. Файл создаётся если не указан.
$ command >> file  - Добавляет в конец файла.
command | command  - Выполнение комманд по очереди.
Поток stdout обозначается - 1, а поток stderr - 2.
$ls /incorrectdir > f       - файл создан не будет, stderr пойдет в консоль.
$ls /incorrectdir > f 2>e   - файл f будет пустым, а сообщение об ошибке пойдет в файл e.
$ls /incorrectdir > f 2>&1  - в файл пойдут и stdout, и stderr.

% Список процессов
ps - отображает процессы. x - Запущенные пользователем. ax - все процессы. 
     u - больше деталей. w - ешё больше деталей.
kill <pid>         - просит ядро послать сигнал TERM процессу.
kill -STOP <pid>   - посылает сигнал STOP, остановить процесс.
kill -CONT <pid>   - сигнал CONT - возобновить процесс.
Ctrl + C           - посылает сигнал INT.
kill -KILL <pid>   - сигнал KILL убивает процесс инстантно.
Ctrl + Z           - посылает сигнал TSTP - переводит процесс в фон. 
                     (fg/bg - вывести/убрать в фон)
$ firefox &        - Запустит ff в фоне и терминалом можно продолжить пользоваться.

% Режимы файлов и права доступа.
% -.rw-.r--.r--
% 1.222.333.444
1 - Тип файла.
2 - Права доступа пользователя.
3 - Права доступа группы.
4 - Другие права доступа.
% Некоторые типы
- - Простой файл.
d - Директория.
l - Ссылка.
b - Блочтое устройство.
c - Символьное устройство.
p - Канал. 
s - Сокет.
chmod <mode> <file> - изменение прав доступа. mode: u(user), g(group), o(other)
$ chmod uo+x myfile
mode можно задать восьмеричным числом. Используются первые 9 бит слева на право 
в соответствии шаблону. Тоесть chmod 3 file -> - --- --- -wx. 
644 -> -rw-r--r--.
У каталога должно быть право доступа на исполнение, иначе он не откроется. 
В nano затребует пароль.
% Ссылки
ln -s <target> <linkname> - Создаёт символическую ссылку. Без -s создаст 
                            жесткую ссылку, как в си.
% Архивация
gzip <file>        - Сожмет файл в *.gz. Может сжать только один файл, архив сделать 
                     не может.
gunzip <file.gz>   - Отжимает файл.
tar cvf <name.tar> <f> <f> - Пакует в архив. Флаги: v - покажет детали при запаковке, 
                      еще одно v - покажет еще больше деталей; f <name.tar> - 
                      задаёт имя архива. Для применения стандартных ввода-
                      вывода можно использовать '-' вместо именм файла.
tar xvf <name.tar> - Отжимает архив. Сам архив не удаляется.
tar tvf <name.tar> - Проверяет общую целостность архива и дает возможность 
                     просмотреть его содержимое.
tar ztvf <tame.tar.gz> - Распакует *.tar.gz(*.tgz) файл. 
% Устройства
udevadm info --query=all --name=/dev/sda - Показывает sysfs-пути устройства и 
                                           прочее.

% -----------------------------------------------------------------------------
% SYSTEMD
% -----------------------------------------------------------------------------
Модули(UNIT) в systemd, это как правило:
- Модули служб. (Котнролируют традиционные демоны служб в системе.)
- Модули монтирования. (Контролируют присоединение файловых систем.)
- Целевые модули. (Контролируют другие модули. Как правило группируя их.)

% Зависимости модулей.
Requires   - при запуске модуля, запускает зависимости или они уже должны быть
             запущенны, иначе не стартует.
Wants      - во время активизации модуля пытается активизировать "want" 
             зависимость, но продолжает свою работу, если зависимость не смогла 
             запуститься.
Requisite  - при запуске модуля требует что бы "requisite" модули уже были 
             запущены, иначе не стартанет.
Conflicts  - деактивизирует модули "conflicts" во время запуска. Если 
             запускаются два конфликтующих модуля то произойдет сбой.
WantedBy   - говорит о том что загружаемый модуль желателен для "wantedby" 
             модулей.
RequiredBy - говорит о том что загружаемый модуль необходим для "requiredby" 
             модуля.
Before     - модуль должен загрузиться до модулей указанных в Before.
After      - модуль должен загрузиться после модулей указанных в After.

# systemctl show -p <type> <unit> - можно посмотреть зависимостм модулей.

% Условные зависимости.
Если они не выполняются то модуль не запустится.
Например:
CondigionPathExists=<path>
ConditionPathIsDirectory=<path>
ConditionFileNotEmpty=<path>

/usr/lib/systemd/system - каталог системных модулей.
/etc/systems/system     - каталог системных конфигураций.

# systemctl -p UnitPath show - показывает текущий путь поиска комманды SYSTEMD
                               (включая приоритет).
$ pkg-config systemd --variable=systemdsystemunitdir - показывает каталог 
                                                       системных модулей.
$ pkg-config systemd --variable=systemdsystemconfdir - показывает коталог 
                                                       системных конфигураций.

Подключение модуля (systemctl enable) вносит его в конфигурацию systemd которые
сохранятся после перезагрузки.
Например в NetworkManager.service(/usr/lib/systemd/system) есть секция 
[Install]. При вызове systemctl enable зависимость 
WantedBy=multi-user.targe добавляется в виде ссылки на NetworkManager.service
в каталог /etc/systemd/system/multi-user.taarget.wants. Ссылка выглядит так:
$ ln -s '/usr/lib/systemd/system/NetworkManager.service' '/etc/systemd/system/mul
ti-user.target.wants/NetworkManager.service'

Активация модуля (systemctl start) лиш задействует его в текущем окружении 
пользователя.

$ systemctl list-units - показывает список активных модулей. Она срабатывает 
по умолчанию при запуске systemctl без параметров. --full - покажет полные 
имена модулей. --all - покажет все модули, а не только активные.
$ systemctl status <module_name> - статус модуля.
$ journalctl _SYSTEMD_UNIT=unit - отобразит полный журнал модуля.
$ systemctl start|stop|restart - активизация, остановка и перезапуск модуля.
$ systemctl reload <unit> - перезагружает только конфигурацию модуля.
$ systemctl daemon-reload - перезагружает конфигурацию всех модулей.
$ systemctl list-jobs - текущие задания в системе.

% Группы управления. cgroups

С помощью параметра Type в файле модуля службы можно задать её поведение.
1. Type=simple - процесс службы не ветвится.
2. Type=forking - служба ветвится, и команда systemd ожидает завершения
исходного процесса службы. По его завершении команда systemd прудполагает,
что данная служба готова.
3. Type=notify - когда служба готова, она отрпавляет уведомление спуциально для
команды systemd (с помощью вызова функции sd_notify()).
4. Type=dbus - когда служба готова она регестрирует себя в шине D-Bus.
5. Type=oneshot - процесс службы завершается полностью по окончании своей работы
(пабота это запуск юнита, systemctl list-jubs(как я понял)). Для служб 
подобного типа непреьенно следует добпвлять параметр RemaniAfterExit=yes, чтобы
команда systemd по-прежнему рассматривала данную службу как активную даже после
завершения её процессов.
6. Type=idle - указывает systemd не запускать службу пока в системе есть активные
задания.

% Выключение пк.
# shutdown -h now - выключение.(halt)
           -r now - ребут.
           -r +10 - ребут через 10 минут.
           -f - Некоректный моментальный шатдаун.

% Начальная файловая система. initramfs
В большенстве систем начальная файловая система сжата в архив cpio с помощью
утилиты gzip.
У меня это initramfs-linux.img - разжать не смог.

% Логи системное время, пользователи, пакетные задания.
# dmesg     - диагностические сообщения ядра для службы rsyslogd.
/etc/passwd - содержит записи о пользователях. Имеет следующие поля:
1. name      - имя пользователя.
2. password  - "пусто" - нет пароля; "x" - пароль хранится в shaddow; "*" - вход 
               в систему запрещён.
3. uid       - ID пользователя. (uid = 0 - root)
4. gid       - ID группы пользователя (gid = 0 - root)
5. gecos     - реальное имя пользователя
6. dir       - домашний каталог пользователя (home dir)
7. dir       - оболочка пользователя (default: /usr/bin/bash) 

$ adduser
$ userdel
$ passwd

/etc/group - определяет идентификаторы групп. Имеет следующие поля:
1. name - имя группы.
2. pass - пароль группы.
3. GID  - ID группы.
4. user - участники группы в дополнение тем которые указаны в /etc/password

$ groups - Показывает группы пользователя.
$ id - Показывает группы, ID, и имя текущего пользователя.
$ usermod - изменяет настройки пользователя.
% Часы

# hwclock - сброс системных часов к аппаратным.
# hwclock --hctosys --utc - Настраивает аппаратные часы на UTC время.

% Планирование задач
cron - " в systemd имеет какой-то аналог".

$ at 22:30
at> command
Ctrl+D
$ atq - показывает что запланировано.
$ atrm - удаляет запланированное событие.

% Варианты ID пользователя.
В Linux можно запускать процессы от чужого имени. setuid комманды (su и sudo)
1. euid - эфективный ID. (исполнитель)
2. ruid - реальный ID.   (владелец)
3. suid - сохраненный ID.
4. fsuid - ID пользователя файловой системой.

$ ps -eo pid,euser,ruser,comm - для просмотра разных ID.(почти всегда euid=ruid)
% -----------------------------------------------------------------------------
% Отслеживание процессов и ресурсов
% -----------------------------------------------------------------------------
$ ps
$ top 
$ lsof - открытые файлы и процессы которые их используют.
$ lsof /usr - отображает файлы открытые в /usr.
$ lsof -p <pid>
$ strace cat /dev/null - Отображает все системные вызовы процесса.
$ ltrace - отслеживает вызовы совместно используемых библиотек.
$ time ls - отобразит количество процессорного времени потраченного на комманду ls.
real - общее время.
user - время потраченное на выполнение самой команды.
sys  - время потраченное ядром на выполнения работы процесса.

% Поиоритет процесса
Приоритет процесса может быть от - 20 до 20 где 20 низший приоритет.
$ renice 20 <pid> - задаёт приоритет процессу.
% Среднее значение загрузки
Среднее значение загрузки - это среднее количество процессов готовых к запуску 
                            (на исполнение для процесора).
$ uptime - сообщает текущее время, время работы системы, и 3 числа средней
загрузки (за 1, и 15 минут).

% Память
$ free - показывает итформацию о памяти.
$ cat /proc/meminfo - тоже покажет информацию о памяти.

MMU - модуль процессора отвечающий за адресацию страниц памяти.
    Малая(minor) ощибка страниц памяти - страница находится в памяти но модуль 
MMU не знает где она. Ядру приходится сообщать о её местоположении.
    Большая(major) ошибка страниц памяти - страница памяни не находится в памяни 
а находится на диске или еще где. Ядро должно загрузить эту страницу обратно в
память.

ps -o pid,min_flt,maj_flt <pid> 

$ vmstat 2 - очередной итструмент отслеживания производительности. (2 - значит
результат обновляется каждые 2 секунды).
Поля: % подробнее vmstat(8)
proc:
 r - run
 b - blocked (запуск не разрешён)
memory:
 swpd - перемещено Kb на диск.
 free - свободно Kb памяти.
 buff - объём памяти для дисковых буферов.
swap:
 si - swap in.(не обязательно свап, может еще читать dll)
 so - swap out.
io:
 bi - blocks in
 bo - blocks out
system:
 in -
 cs -
cpu:
 us - % user cpu usage
 sy - % system cpu usage
 id - % idle
 wa - % input output wate

% Отслеживание Ввода-Вывода
$ iostat

% -----------------------------------------------------------------------------
% Сеть
% -----------------------------------------------------------------------------

ip [OPTIONS] OBJECT {COMMAND | help}
objects:
    link, l - Отображение, изменение сетевых интерфейсов.
    address, addr, a - Отображение, изменение IP4/6 адресов.
    route, r - Отображение, изменение таблицы маршрутизации.
    neigh, n - Отображение, управление соседними объектами (таблица ARP)

/etc/services - файл с переводами значений хорошо известных портов в имена.
nm-online - Сообщает о том, функционирует сеть или нет.
nmcli - Cli для NetworkManager.
/etc/resolv.conf - Файл конфигурации для серверов DNS.

